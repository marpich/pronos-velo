<% if @stage.date == Date.current %>
  <h1>Etape du Jour</h1>
<% else %>
  <h1>Etape n°<%= @stage.number %></h1>
<% end %>

<div class="container-wrapper">

  <div class="stage-card">
    <div class= "stage-info">
      <p>Etape <%= @stage.number %></p>
        <% case @stage.stage_type %>
          <% when 'Montagne' %>
          <p><i class="fas fa-mountain"></i></p>
          <% when 'Accidentee' %>
          <p><i class="fas fa-exclamation-triangle"></i></p>
          <% when 'Chrono' %>
          <p><i class="fas fa-stopwatch"></i></p>
          <% when 'Plat' %>
          <p><i class="fas fa-road"></i></p>
        <% end %>
      <%= @stage.date %>
    </div>
    <div class="stage-map">
      <img src="<%= cl_image_path @stage.image.key%>" width = "100%" >
    </div>
  </div>

  <h2 class="text-center">Mon Prono</h2>

  <% if (@my_bets.nil? || @my_bets.empty?) && @bet.present? %>
    <%= form_with url: stage_bets_path(@stage), method: :post do |f| %>
      <%= f.select :rider_1, Rider::RIDERS, prompt: 'Vainqueur' %>
      <%= f.select :rider_2, Rider::RIDERS, prompt: 'Deuxième' %>
      <%= f.select :rider_3, Rider::RIDERS, prompt: 'Troisième' %>
      <%= f.submit "En selle!", class: "btn btn-primary" %>
    <% end %>
  <% end %>

  <% unless (@players.nil? || @players.empty?) %>
  <div class="flex justify-center prono">
      <div class="bet-card">
        <% @players.each do |player| %>
          <div class="bet-user-info">
            <p><%= cl_image_tag player.photo.key, class: "avatar" %> <%= player.username %></p>
              <p><%= player.display_score(@stage) %></p>
          </div>
          <div class="bet-details">
            <% player.bets.each do |bet| %>
              <p><%= bet.position %>. <%= bet.rider.first_name %> <%= bet.rider.last_name %></p>
            <% end %>
          </div>
        <% end %>

      </div>
    </div>
  <% end %>

  <h1>Le résultat de l'étape</h1>
  <%= form_with url: stage_results_path(@stage), method: :post do |f| %>
    <%= f.select :rider_1, Rider::RIDERS, prompt: 'Vainqueur' %>
    <%= f.select :rider_2, Rider::RIDERS, prompt: 'Deuxième' %>
    <%= f.select :rider_3, Rider::RIDERS, prompt: 'Troisième' %>
    <%= f.submit "Ajouter", class: "main-button" %>
  <% end %>

</div>
